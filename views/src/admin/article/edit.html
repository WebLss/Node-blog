<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>添加标签</title>

    <%- partial('../../common/bootstrapCss') %>
    <%- partial('../../common/icheckCss') %>
    <link rel="stylesheet" type="text/css" href="<%=static.__STATIC__%>editor/css/editormd.min.css"/>
    <link rel="stylesheet" type="text/css" href="<%=static.__ADMIN_CSS__%>common.css"/>

    <style>
        #test-editormd{
            z-index: 9999;
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <span class="tag">
                <b>文章管理</b> / 编辑文章
            </span>
        </div>
    </div>
    <div class="row margin-top-1 animated fadeIn">
        <div class="col-md-10 col-md-offset-1">
            <form id="addCategory" class="form-wrap">
                <table class="table">
                    <tr>
                        <th width="7%"><span style="color:red">*</span>&nbsp;所属分类</th>
                        <td>
                            <select id="cid" class="form-control modal-sm" name="cid">

                                <option value="0">顶级栏目</option>
                                <%  result.cateList.forEach(function (item) { %>
                                <option value="<%=item._id%>"  <% if(item._id.toString() == result.article.category_id){ %> selected="selected" <% } %>>
                                <%=item.html%><%=item.cname%>
                                </option>
                                <% }) %>
                                <!-- <foreach name="data" key="k" item="v">
                                     <option value="{$v['cid']}" <if condition="$cid eq $v['cid']">selected="selected"</if> >{$v['_name']}</option>
                                 </foreach>-->
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th><span style="color:red">*</span>&nbsp;标题</th>
                        <td>
                            <input id="title" class="form-control modal-sm" type="text" name="title" value="<%=result.article.title%>">
                        </td>
                    </tr>
                    <tr>
                        <th><span style="color:red">*</span>&nbsp;作者</th>
                        <td>
                            <input id="author" class="form-control modal-sm" type="text" name="author" value="<%=result.article.author%>">
                        </td>
                    </tr>
                    <tr>
                        <th>标签</th><!--checked='checked'-->
                        <td>
                            <% result.tagList.forEach(function (item) { %>
                                <span class="inputword"><%=item.name%></span>

                                <input class="icheck" type="checkbox" name="tids" value="<%=item._id%>" <% if(result.artByTag.indexOf(item._id.toString()) != -1){ %>checked='checked' <% } %>>
                                &emsp;
                            <% }) %>

                        </td>
                    </tr>
                    <tr>
                        <th>关键词</th>
                        <td>
                            <input class="form-control modal-sm" placeholder="多个关键词用顿号分隔" type="text" name="keywords" value="<%=result.article.keywords%>">
                        </td>
                    </tr>
                    <tr>
                        <th>描述</th>
                        <td>
                            <textarea class="form-control modal-sm" name="description" rows="7"><%=result.article.description%></textarea>

                        </td>
                    </tr>
                    <tr>
                        <th><span style="color:red">*</span>&nbsp;内容</th>
                        <td>
                            <div id="test-editormd">
                                <textarea id="markdown" name="markdown"><%=result.article.markdown%></textarea>
                            </div>

                        </td>
                    </tr>
                    <tr>
                        <th>是否原创</th>
                        <td>
                            <span class="inputword">是</span>
                            <input class="icheck" type="radio" name="is_original" value="1" checked="checked">
                            &emsp;
                            <span class="inputword">否</span>
                            <input class="icheck" type="radio" name="is_original" value="0">
                        </td>
                    </tr>
                    <tr>
                        <th>是否置顶</th>
                        <td>
                            <span class="inputword">是</span>
                            <input class="icheck" type="radio" name="is_top" value="1">
                            &emsp;
                            <span class="inputword">否</span>
                            <input class="icheck" type="radio" name="is_top" value="0" checked="checked">
                        </td>
                    </tr>
                    <tr>
                        <th>是否显示</th>
                        <td>
                            <span class="inputword">是</span>
                            <input class="icheck" type="radio" name="is_show" value="1" checked="checked">
                            &emsp;
                            <span class="inputword">否</span>
                            <input class="icheck" type="radio" name="is_show" value="0">
                        </td>
                    </tr>
                    <tr>
                        <th></th>
                        <td>
                            <input type="hidden" value="<%=result.article._id%>" name="id">
                            <input class="btn lss-btn-primary" type="button" value="保存" onclick="sub()">
                        </td>
                    </tr>
                </table>
            </form>
        </div>
    </div>
</div>

<%- partial('../../common/bootstrapJs') %>
<%- partial('../../common/icheckJs', { color: 'blue' }) %>
<!-- markdown editor -->
<script type="text/javascript"  src="<%=static.__STATIC__%>editor/editormd.min.js"></script>

<script>
  var testEditor;
  $(function() {
    editormd.urls.atLinkBase = "https://github.com/";
    testEditor = editormd("test-editormd", {
      width     : "100%",
      height    : 620,
      toc       : true,
      //atLink    : false,    // disable @link
      //emailLink : false,    // disable email address auto link
      todoList  : true,
      placeholder: '输入文章内容',
      toolbarAutoFixed: false,
      path: "/public/static/editor/lib/",
      emoji: true
    });
  })


  function sub() {
    if(check())
    $.ajax({
      url: '/admin/article/edit',
      dataType: 'json',
      type: 'post',
      data: $('#addCategory').serialize(),
      success: function (result) {
        if(result.code === 200) {
          layer.msg(result.message, {icon: 1, time: 1500});
        } else {
          layer.msg(result.message, {icon: 2, time: 1500});
        }
      }, error: function (err) {
        layer.msg(err.message, {icon: 2, time: 1500});
      }
    })
  }
  
  function check() {
    var msg = ''
    if (!$('#title').val().trim())  {
      msg = "文章标题不能为空"
    } else if (!$('#author').val().trim()) {
      msg = "作者不能为空"
    } else if (!$('#cid').val().trim() || $('#cid').val() == '0') {
      msg = "栏目必须选择"
    } else if (!$('#markdown').val().trim()) {
      msg = "内容必须选择"
    }
    if(msg) {
      layer.msg(msg, {icon: 2, time: 1500});
      return false;
    } else {
      return true;
    }
  }
</script>
</body>
</html>
